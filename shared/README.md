<<<<<<< HEAD
# IMèŠå¤©ç³»ç»ŸæœåŠ¡ç«¯

åŸºäºŽNode.js + Express + Socket.io + SQLiteæž„å»ºçš„å®žæ—¶èŠå¤©æœåŠ¡ç«¯ã€‚

## ðŸš€ åŠŸèƒ½ç‰¹æ€§

âœ… **åŸºç¡€æž¶æž„**
- âœ… TypeScript + Node.jså¼€å‘çŽ¯å¢ƒ
- âœ… Express Webæ¡†æž¶
- âœ… SQLiteè½»é‡çº§æ•°æ®åº“
- âœ… Winstonæ—¥å¿—ç³»ç»Ÿ
- âœ… çŽ¯å¢ƒé…ç½®ç®¡ç†

âœ… **æ•°æ®åº“**
- âœ… ç”¨æˆ·è¡¨ï¼ˆusersï¼‰
- âœ… æ¶ˆæ¯è¡¨ï¼ˆmessagesï¼‰
- âœ… åœ¨çº¿ç”¨æˆ·è¡¨ï¼ˆonline_usersï¼‰
- âœ… æ•°æ®åº“è¿žæŽ¥ç®¡ç†
- âœ… äº‹åŠ¡æ”¯æŒ

âœ… **RESTful API**
- âœ… `GET /api/health` - å¥åº·æ£€æŸ¥
- âœ… `GET /api/messages` - åŽ†å²æ¶ˆæ¯æŸ¥è¯¢
- âœ… `GET /api/messages/recent` - æœ€è¿‘æ¶ˆæ¯
- âœ… `GET /api/messages/stats` - æ¶ˆæ¯ç»Ÿè®¡

âœ… **WebSocketæœåŠ¡**
- âœ… Socket.ioé›†æˆ
- âœ… ç”¨æˆ·è¿žæŽ¥ç®¡ç†
- âœ… å®žæ—¶æ¶ˆæ¯å¹¿æ’­
- âœ… ç”¨æˆ·è¿›å‡ºé€šçŸ¥
- âœ… å¿ƒè·³æ£€æµ‹

âœ… **å®‰å…¨ç‰¹æ€§**
- âœ… è¾“å…¥éªŒè¯ï¼ˆJoiï¼‰
- âœ… é¢‘çŽ‡é™åˆ¶
- âœ… CORSé…ç½®
- âœ… å®‰å…¨å¤´è®¾ç½®
- âœ… é”™è¯¯å¤„ç†

## ðŸ“‹ æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**: Node.js 16+
- **æ¡†æž¶**: Express 4.18
- **WebSocket**: Socket.io 4.7
- **æ•°æ®åº“**: SQLite 3
- **è¯­è¨€**: TypeScript 4.9
- **æ—¥å¿—**: Winston 3.8
- **éªŒè¯**: Joi 17.9

## ðŸ›  å¿«é€Ÿå¼€å§‹

### çŽ¯å¢ƒè¦æ±‚

```bash
Node.js >= 16.0.0
npm >= 8.0.0
```

### å®‰è£…ä¾èµ–

```bash
npm install
```

### çŽ¯å¢ƒé…ç½®

å¤åˆ¶çŽ¯å¢ƒå˜é‡æ–‡ä»¶ï¼š
```bash
cp .env.example .env
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

æœåŠ¡å™¨å°†åœ¨ http://localhost:3001 å¯åŠ¨

### æž„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build
npm start
```

## ðŸ“š APIæ–‡æ¡£

### å¥åº·æ£€æŸ¥

```http
GET /api/health
```

å“åº”ï¼š
```json
{
  "success": true,
  "data": {
    "status": "ok",
    "timestamp": "2025-01-XX",
    "uptime": 3600,
    "connections": 5,
    "version": "1.0.0",
    "database": "connected"
  }
}
```

### åŽ†å²æ¶ˆæ¯

```http
GET /api/messages?limit=50&before=timestamp
```

### WebSocketäº‹ä»¶

#### ç”¨æˆ·åŠ å…¥
```javascript
socket.emit('user:join', { username: 'Alice' });
```

#### å‘é€æ¶ˆæ¯
```javascript
socket.emit('message:send', {
  type: 'text',
  content: 'Hello world!'
});
```

#### æŽ¥æ”¶æ¶ˆæ¯
```javascript
socket.on('message:received', (message) => {
  console.log(message);
});
```

## ðŸ“ é¡¹ç›®ç»“æž„

```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.ts                 # Expressåº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ server.ts              # æœåŠ¡å™¨å¯åŠ¨å…¥å£
â”‚   â”œâ”€â”€ config/                # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ controllers/           # è·¯ç”±æŽ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ healthController.ts
â”‚   â”‚   â””â”€â”€ messageController.ts
â”‚   â”œâ”€â”€ database/              # æ•°æ®åº“
â”‚   â”‚   â”œâ”€â”€ connection.ts      # æ•°æ®åº“è¿žæŽ¥
â”‚   â”‚   â””â”€â”€ schema.sql         # è¡¨ç»“æž„
â”‚   â”œâ”€â”€ middleware/            # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ errorHandler.ts    # é”™è¯¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ security.ts        # å®‰å…¨ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ validation.ts      # è¾“å…¥éªŒè¯
â”‚   â”œâ”€â”€ models/                # æ•°æ®æ¨¡åž‹
â”‚   â”‚   â”œâ”€â”€ User.ts
â”‚   â”‚   â”œâ”€â”€ Message.ts
â”‚   â”‚   â””â”€â”€ OnlineUser.ts
â”‚   â”œâ”€â”€ routes/                # è·¯ç”±
â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”œâ”€â”€ services/              # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â””â”€â”€ socketService.ts   # Socket.ioæœåŠ¡
â”‚   â”œâ”€â”€ types/                 # TypeScriptç±»åž‹
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ logger.ts          # æ—¥å¿—å·¥å…·
â”œâ”€â”€ data/                      # SQLiteæ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ logs/                      # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ uploads/                   # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â””â”€â”€ package.json
```

## ðŸ§ª æµ‹è¯•

é¡¹ç›®åŒ…å«å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼Œä½äºŽ `tests/` ç›®å½•ï¼š

### å¿«é€Ÿæµ‹è¯•éªŒè¯
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./tests/run-all-tests.sh

# è¿è¡Œæ ¸å¿ƒéªŒè¯æµ‹è¯•
node tests/final-verification.test.js

# è¿è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•
node tests/complete-feature.test.js
```

### æµ‹è¯•è¦†ç›–èŒƒå›´
- âœ… å¤šç”¨æˆ·è¿žæŽ¥ç®¡ç†
- âœ… ç”¨æˆ·ä¿¡æ¯åŒæ­¥éªŒè¯
- âœ… æ¶ˆæ¯å‘é€æŽ¥æ”¶åŠŸèƒ½
- âœ… ç”¨æˆ·åå†²çªæ£€æµ‹
- âœ… Socket.ioäº‹ä»¶å¤„ç†
- âœ… æ•°æ®åº“æ“ä½œå®Œæ•´æ€§

### ä¸“é¡¹æµ‹è¯•
- **ç”¨æˆ·åŒæ­¥é—®é¢˜ä¿®å¤éªŒè¯** - ç¡®ä¿å¤šç”¨æˆ·ç™»å½•æ—¶ä¿¡æ¯ä¸ä¼šæ··æ·†
- **å®žæ—¶æ¶ˆæ¯ä¼ é€’æµ‹è¯•** - éªŒè¯æ¶ˆæ¯åœ¨ç”¨æˆ·é—´æ­£ç¡®ä¼ é€’
- **è¿žæŽ¥çŠ¶æ€ç®¡ç†æµ‹è¯•** - éªŒè¯ç”¨æˆ·ä¸Šçº¿ä¸‹çº¿çŠ¶æ€æ­£ç¡®æ›´æ–°

è¯¦ç»†æµ‹è¯•è¯´æ˜Žè¯·å‚è€ƒ [`tests/README.md`](tests/README.md)

## ðŸ“ˆ ç›‘æŽ§

æœåŠ¡å™¨æä¾›ä»¥ä¸‹ç›‘æŽ§èƒ½åŠ›ï¼š

- å¥åº·æ£€æŸ¥æŽ¥å£
- Winstonç»“æž„åŒ–æ—¥å¿—
- åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡
- æ¶ˆæ¯å¤„ç†é‡ç»Ÿè®¡
- ç³»ç»Ÿè¿è¡Œæ—¶é—´

## ðŸ”§ é…ç½®é€‰é¡¹

| çŽ¯å¢ƒå˜é‡ | é»˜è®¤å€¼ | è¯´æ˜Ž |
|---------|--------|------|
| NODE_ENV | development | è¿è¡ŒçŽ¯å¢ƒ |
| PORT | 3001 | æœåŠ¡ç«¯å£ |
| DATABASE_PATH | ./data/app.db | æ•°æ®åº“è·¯å¾„ |
| LOG_LEVEL | debug | æ—¥å¿—çº§åˆ« |
| MAX_ONLINE_USERS | 100 | æœ€å¤§åœ¨çº¿ç”¨æˆ·æ•° |
| MAX_MESSAGE_LENGTH | 1000 | æœ€å¤§æ¶ˆæ¯é•¿åº¦ |

## ðŸš€ éƒ¨ç½²

### Dockeréƒ¨ç½²ï¼ˆæŽ¨èï¼‰

```bash
# æž„å»ºé•œåƒ
docker build -t im-chat-server .

# è¿è¡Œå®¹å™¨
docker run -p 3001:3001 -v $(pwd)/data:/app/data im-chat-server
```

### PM2éƒ¨ç½²

```bash
npm run build
pm2 start dist/server.js --name "im-chat-server"
```

## ðŸ›¡ å®‰å…¨è€ƒè™‘

- è¾“å…¥éªŒè¯å’Œæ¸…ç†
- é¢‘çŽ‡é™åˆ¶é˜²æ­¢æ»¥ç”¨
- å®‰å…¨HTTPå¤´è®¾ç½®
- é”™è¯¯ä¿¡æ¯ä¸æ³„éœ²æ•æ„Ÿæ•°æ®
- æ•°æ®åº“è¿žæŽ¥å®‰å…¨

## ðŸ“„ è®¸å¯è¯

ISC License

## ðŸ¤ è´¡çŒ®

æ¬¢è¿Žæäº¤Issueå’ŒPull Requestï¼

---

**æ³¨æ„**: è¿™æ˜¯åŸºç¡€ç‰ˆæœ¬ï¼ŒåŽç»­å¯ä»¥æ‰©å±•ï¼š
- æ–‡ä»¶ä¼ è¾“åŠŸèƒ½
- ç¾¤ç»„èŠå¤©
- ç”¨æˆ·è®¤è¯
- éŸ³è§†é¢‘é€šè¯ä¿¡ä»¤
=======
# Shared Library - IMèŠå¤©ç³»ç»Ÿå…¬å…±åº“

## ðŸ“– æ¦‚è¿°

è¿™æ˜¯IMèŠå¤©ç³»ç»Ÿçš„å…±äº«ä»£ç åº“ï¼ŒåŒ…å«å‰åŽç«¯é€šç”¨çš„ç±»åž‹å®šä¹‰ã€æŽ¥å£è§„èŒƒã€å·¥å…·å‡½æ•°ç­‰ã€‚é€šè¿‡è½¯é“¾æŽ¥çš„æ–¹å¼åŒæ­¥åˆ°serverå’Œclienté¡¹ç›®ä¸­ã€‚

## ðŸš¨ é‡è¦æ›´æ–°é€šçŸ¥

### v1.1.0 - ç”¨æˆ·ä¿¡æ¯åŒæ­¥é—®é¢˜ä¿®å¤ (2025-01-XX)

**âš ï¸ éœ€è¦å®¢æˆ·ç«¯æ›´æ–°**: ä¸ºä¿®å¤å¤šç”¨æˆ·ç™»å½•æ—¶çš„ç”¨æˆ·ä¿¡æ¯åŒæ­¥é—®é¢˜ï¼Œæˆ‘ä»¬å¯¹Socket.ioäº‹ä»¶è¿›è¡Œäº†é‡è¦æ›´æ”¹ã€‚

**å…³é”®å˜æ›´**:
- æ–°å¢ž `user:new-member-joined` äº‹ä»¶
- `user:joined` äº‹ä»¶èŒè´£è°ƒæ•´ï¼ˆä»…ç”¨äºŽè‡ªèº«ç™»å½•ç¡®è®¤ï¼‰

**ðŸ”§ å¿«é€Ÿè¿ç§»**:
```javascript
// æ–°å¢žï¼šç›‘å¬æ–°æˆå‘˜åŠ å…¥
socket.on('user:new-member-joined', (data) => {
  console.log(`${data.newMember.username} åŠ å…¥äº†èŠå¤©å®¤`);
  updateOnlineUsers(data.onlineUsers);
});
```

ðŸ“– **è¯¦ç»†ä¿¡æ¯**: 
- ðŸš¨ [å®¢æˆ·ç«¯ç´§æ€¥æ›´æ–°é€šçŸ¥](./CLIENT-UPDATE-NOTICE.md) â† **ç«‹å³æŸ¥çœ‹**
- [å®Œæ•´å˜æ›´è¯´æ˜Ž](./API-CHANGES.md)
- [å®¢æˆ·ç«¯è¿ç§»æŒ‡å—](./MIGRATION-GUIDE.md)
- [è¯¦ç»†å‘å¸ƒè¯´æ˜Ž](./RELEASE-NOTES.md)
- [ç‰ˆæœ¬å˜æ›´æ—¥å¿—](./CHANGELOG.md)
- [æ–‡æ¡£å¯¼èˆªç´¢å¼•](./INDEX.md)

## ðŸ“ ç›®å½•ç»“æž„

```
shared/
â”œâ”€â”€ README.md                    # æœ¬æ–‡ä»¶
â”œâ”€â”€ CHANGELOG.md                 # å˜æ›´æ—¥å¿—
â”œâ”€â”€ API-CHANGES.md               # APIå˜æ›´é€šçŸ¥
â”œâ”€â”€ MIGRATION-GUIDE.md           # å®¢æˆ·ç«¯è¿ç§»æŒ‡å—
â”œâ”€â”€ CLIENT-UPDATE-NOTICE.md      # ðŸš¨ å®¢æˆ·ç«¯ç´§æ€¥æ›´æ–°é€šçŸ¥
â”œâ”€â”€ RELEASE-NOTES.md             # è¯¦ç»†å‘å¸ƒè¯´æ˜Ž
â”œâ”€â”€ INDEX.md                     # æ–‡æ¡£å¯¼èˆªç´¢å¼•
â”œâ”€â”€ types/                       # TypeScriptç±»åž‹å®šä¹‰
â”‚   â”œâ”€â”€ index.ts                 # å¯¼å‡ºæ‰€æœ‰ç±»åž‹
â”‚   â”œâ”€â”€ user.ts                  # ç”¨æˆ·ç›¸å…³ç±»åž‹
â”‚   â”œâ”€â”€ message.ts               # æ¶ˆæ¯ç›¸å…³ç±»åž‹
â”‚   â”œâ”€â”€ socket.ts                # Socketäº‹ä»¶ç±»åž‹
â”‚   â””â”€â”€ api.ts                   # APIæŽ¥å£ç±»åž‹
â”œâ”€â”€ constants/                   # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ index.ts                 # å¯¼å‡ºæ‰€æœ‰å¸¸é‡
â”‚   â”œâ”€â”€ events.ts                # Socketäº‹ä»¶å¸¸é‡
â”‚   â”œâ”€â”€ errors.ts                # é”™è¯¯ç å¸¸é‡
â”‚   â””â”€â”€ config.ts                # é…ç½®å¸¸é‡
â”œâ”€â”€ validators/                  # æ•°æ®éªŒè¯è§„åˆ™
â”‚   â”œâ”€â”€ index.ts                 # å¯¼å‡ºæ‰€æœ‰éªŒè¯å™¨
â”‚   â”œâ”€â”€ user.ts                  # ç”¨æˆ·æ•°æ®éªŒè¯
â”‚   â””â”€â”€ message.ts              # æ¶ˆæ¯æ•°æ®éªŒè¯
â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ index.ts                 # å¯¼å‡ºæ‰€æœ‰å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ format.ts                # æ ¼å¼åŒ–å·¥å…·
â”‚   â””â”€â”€ validate.ts              # éªŒè¯å·¥å…·
â””â”€â”€ docs/                        # æ–‡æ¡£
    â”œâ”€â”€ api-spec.md              # APIæŽ¥å£è§„èŒƒ
    â”œâ”€â”€ socket-events.md         # Socketäº‹ä»¶æ–‡æ¡£
    â””â”€â”€ data-models.md           # æ•°æ®æ¨¡åž‹æ–‡æ¡£
```

## ðŸ”§ ä½¿ç”¨æ–¹å¼

### åœ¨Serveré¡¹ç›®ä¸­ä½¿ç”¨
```typescript
import { User, Message, SocketEvents } from '@shared/types'
import { USER_EVENTS, ERROR_CODES } from '@shared/constants'
import { validateUserName } from '@shared/validators'
```

### åœ¨Clienté¡¹ç›®ä¸­ä½¿ç”¨
```typescript
import { User, Message, ApiResponse } from '@shared/types'
import { SOCKET_EVENTS, MAX_MESSAGE_LENGTH } from '@shared/constants'
import { formatTimestamp } from '@shared/utils'
```

## ðŸ“‹ å¼€å‘è§„èŒƒ

### ç±»åž‹å®šä¹‰è§„èŒƒ
- ä½¿ç”¨PascalCaseå‘½åæŽ¥å£å’Œç±»åž‹
- æ‰€æœ‰æŽ¥å£å¿…é¡»å¯¼å‡ºå¹¶åœ¨index.tsä¸­é‡æ–°å¯¼å‡º
- æ·»åŠ è¯¦ç»†çš„JSDocæ³¨é‡Š

### å¸¸é‡å®šä¹‰è§„èŒƒ
- ä½¿ç”¨UPPER_SNAKE_CASEå‘½åå¸¸é‡
- æŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç»„ç»‡
- æä¾›é»˜è®¤å€¼å’Œè¯´æ˜Žæ³¨é‡Š

### å˜æ›´ç®¡ç†
- ä»»ä½•æŽ¥å£å˜æ›´å¿…é¡»æ›´æ–°CHANGELOG.md
- ç ´åæ€§å˜æ›´éœ€è¦ç‰ˆæœ¬å·å‡çº§
- æ–°å¢žåŠŸèƒ½éœ€è¦æ·»åŠ å¯¹åº”çš„æ–‡æ¡£

## ðŸš€ ç‰ˆæœ¬ç®¡ç†

- **ä¸»ç‰ˆæœ¬å·**ï¼šç ´åæ€§å˜æ›´
- **æ¬¡ç‰ˆæœ¬å·**ï¼šæ–°å¢žåŠŸèƒ½ï¼Œå‘åŽå…¼å®¹
- **ä¿®è®¢ç‰ˆæœ¬å·**ï¼šBugä¿®å¤

## ðŸ“ è´¡çŒ®æŒ‡å—

1. åœ¨sharedç›®å½•è¿›è¡Œä¿®æ”¹
2. æ›´æ–°ç›¸å…³æ–‡æ¡£
3. è®°å½•CHANGELOG
4. ç¡®ä¿ä¸¤ç«¯é¡¹ç›®éƒ½èƒ½æ­£å¸¸ç¼–è¯‘
5. æäº¤å˜æ›´å¹¶æŽ¨é€

---

**æ³¨æ„**ï¼šæ­¤åº“çš„å˜æ›´ä¼šåŒæ—¶å½±å“serverå’Œclienté¡¹ç›®ï¼Œè¯·è°¨æ…Žæ“ä½œå¹¶å……åˆ†æµ‹è¯•ã€‚
>>>>>>> c762bd3d405720d5537ec630c1b27f7c75759c44
